;----------------------------------------------------------------------------------------------
#include "msp430g2553.h"             
;----------------------------------------------------------------------------------------------
        NAME    GGIZ
        EXTERN  DELAY_2MIN
;----------------------------------------------------------------------------------------------                                         
        RSEG    CSTACK                  
        RSEG    CODE                    
;----------------------------------------------------------------------------------------------
RESET:          MOV      #SFE(CSTACK), SP
                MOV.W    #WDTPW+WDTHOLD,&WDTCTL
                CALL     #VER_FREQ_16MHZ
                CMP.W    #0AAAAH,R4
                JEQ      RUN
                CMP.W    #0BBBBH,R4
                JEQ      ERROR  
                MOV.W    #0AAAAH,R4
                JMP      RESET 
RUN:            CALL     #CLEAR_PORTS
                CALL     #CLEAR_REGS
                CALL     #CONFIG_PORTS
                CALL     #DELAY_2MIN
                BIS.B    #BIT4, &P2OUT
                ;CALL     #DISPLAY_ST7920_CONFIG_PORT
                JMP      $
ERROR:          ; INFORMAR AO USUARIO QUE EXISTE UM ERRO. NÃO EXISTENCIA DO CLOCK ESPERADO
                ; EXIBIR ERRO EM UM DISPLAY
                JMP      $ 
;----------------------------------------------------------------------------------------------



;----------------------------------------------------------------------------------------------
; AREA ESPECIFICA DE CONFIGURAÇÃO BÁSICA DO HARDWARE
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
CONFIG_PORTS
;----------------------------------------------------------------------------------------------
                BIS.B     #BIT4, &P2DIR
                RET
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
CLEAR_PORTS
;----------------------------------------------------------------------------------------------
                MOV.B    #000H, &P1DIR
                MOV.B    #000H, &P1OUT
                MOV.B    #000H, &P2DIR
                MOV.B    #000H, &P2OUT
                RET
;----------------------------------------------------------------------------------------------
VER_FREQ_16MHZ ; VERIFICA SE EXISTE A OPÇÃO DE OSCILADOR DE 16MHZ
               ; EXISTINDO JÁ CHAMA O CONFIGURADOR PARA AJUSTAR O CLOCK
;----------------------------------------------------------------------------------------------
                CMP.W    #0AAAAH,R4
                JEQ      ENDNOW_VER
                MOV.W    #0FFFFH,R4
                CMP.B    #0FFH,&CALBC1_16MHZ 
                JEQ      NOK
                JMP      BYE_VER
NOK:            MOV.W    #0BBBBH,R4      
BYE_VER:        CALL     #CALIB_16MHZ    
ENDNOW_VER:     RET
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
CALIB_16MHZ ; CALIBRA PARA OPERAÇÃO EM 16MHZ
;----------------------------------------------------------------------------------------------
                CMP.W    #0FFFFH,R4
                JEQ      CONF16MHZ
                JMP      BYE_CALIB
CONF16MHZ:      CLR.B    &DCOCTL
                MOV.B    &CALBC1_16MHZ,&BCSCTL1
                MOV.B    &CALDCO_16MHZ,&DCOCTL
                MOV.W    #0AABBH,R4
BYE_CALIB:      RET
;----------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------
CLEAR_REGS  ; LIMPA TODOS OS REGISTRADORES
;----------------------------------------------------------------------------------------------
                MOV.W    #00000H,R4
                MOV.W    #00000H,R5
                MOV.W    #00000H,R6
                MOV.W    #00000H,R7
                MOV.W    #00000H,R8
                MOV.W    #00000H,R9
                MOV.W    #00000H,R10
                MOV.W    #00000H,R11
                MOV.W    #00000H,R12
                MOV.W    #00000H,R13
                MOV.W    #00000H,R14
                RET
;----------------------------------------------------------------------------------------------
       COMMON      INTVEC
;----------------------------------------------------------------------------------------------
       ORG     RESET_VECTOR
       DW      RESET
       END
;----------------------------------------------------------------------------------------------